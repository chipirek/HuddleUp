<div class="navbar">

  <script type="text/javascript">
      try {
          ace.settings.check('navbar', 'fixed')
      } catch (e) {
      }
  </script>

  <div class="navbar-inner">
    <div class="container-fluid">

      <a class="brand" href="#">
        <small><i class="icon-check"></i> HuddleUp - <%= @project.name %></small>
      </a>

      <%= render :partial => 'top_nav', :locals => {:post => 'foo'} %>

    </div>
    <!--/.container-fluid-->
  </div>
  <!--/.navbar-inner-->

</div>


<div class="main-container container-fluid">
<a class="menu-toggler" id="menu-toggler" href="#">
  <span class="menu-text"></span>
</a>

<%= render :partial => 'side_nav_1', :locals => {:component => 'project', :project_id => @project.id} %>



<div class="main-content">


<% crumbs = [['Projects', projects_path]] %>

<%= render :partial => '/projects/breadcrumbs', :locals => {:crumbs => crumbs, :title => @project.name} %>

<div class="page-content">
<div class="page-header position-relative">
  <h1><i class="icon-list-alt"></i>Project Dashboard
      <% if @member.is_admin? %>
            <small>
            <i class='icon-double-angle-right'></i>
            <a href="/projects/<%= @project.id %>/edit">Edit this project's definition</a>
            </small>
      <% end %>
  </h1>

</div>
<!--/.page-header-->

<div class="row-fluid">
<div class="span12">
<!--PAGE CONTENT BEGINS-->

<% if flash[:notice] %>
    <div class='alert alert-block alert-success'>
      <button type="button" class="close" data-dismiss="alert"><i class="icon-remove"></i></button>
      <strong><i class="icon-ok"></i> <%= flash[:notice] %></strong>
    </div>
<% end %>

<% if @project.description.nil? %>
<p>
<div class='well'><%= @project.description.html_safe unless @project.description.nil? %></div>
</p>
<% end %>

<div class='row-fluid'>

<div class="span6" id='left-column'>


<!-- widget -->
<div class="widget-box transparent">

  <div class="widget-header">
    <h4 class="lighter smaller"><i class="icon-bar-chart"></i> DASHBOARD</h4>

    <div class="widget-toolbar no-border">
    </div>
  </div>

  <div class="widget-body">
    <div class="widget-main padding-5">
      <div class="tab-content padding-8">
        <span class="btn btn-app btn-small btn-yellow no-hover">
            <span class="bigger-175"> <%= @project.milestones.count %> </span>
                <br/>
                <span class="smaller-90"> Project Milestones </span>
            </span>

            <span class="btn btn-app btn-small btn-pink no-hover">
                <span class="bigger-175"> 0 </span>
                <br/>
                <span class="smaller-90"> Project Alerts </span>
            </span>

            <span class="btn btn-app btn-small btn-grey no-hover">
                <span class="bigger-175"> <%= @project.todos.where('is_complete is null or is_complete = false').count %> </span>
                <br/>
                <span class="smaller-90"> Incomplete Todos </span>
            </span>

            <span class="btn btn-app btn-small btn-success no-hover">
                <span class="bigger-175"> <%= @project.issues.where('is_resolved is null').count %> </span>
                <br/>
                <span class="smaller-90"> Open Issues </span>
            </span>

            <span class="btn btn-app btn-small btn-primary no-hover">
                <span class="bigger-175"> 0 </span>
                <br/>
                <span class="smaller-90"> Unread Messages </span>
            </span>

      </div>
    </div>
  </div>
</div>
<!-- end widget -->


<!-- widget -->
<div class="widget-box transparent">

  <div class="widget-header">
    <h4 class="lighter smaller"><i class="icon-calendar"></i> MILESTONES</h4>

    <div class="widget-toolbar no-border">
    </div>
  </div>

  <div class="widget-body">
    <div class="widget-main padding-5">
      <div class="tab-content padding-8">
        <div id="milestones-gadget" class="tab-pane active">

          <% if @project.milestones.count == 0 %>
              None
          <% else %>

            <% @project.milestones.order('event_date').each do |milestone| %>
                <div class="alert <%= get_milestone_status_color(milestone) %>">
                  <a href="/projects/<%= @project.id %>/milestones/<%= milestone.id %>"><i class='icon-calendar'></i> <%= milestone.subject %></a>
                  <div class='pull-right smaller-80'>Due <%= milestone.event_date.strftime('%m/%d/%Y') %></div>
                  <div class='pull-right'> &nbsp; </div>
                  <div class='pull-right smaller-80'><%= milestone.percent_complete %>% done, </div>
                </div>
            <% end %>

          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- end widget -->

<!-- widget -->
<div class="widget-box transparent">

  <div class="widget-header">
    <h4 class="lighter smaller"><i class="icon-list"></i> OPEN TODOS</h4>

    <div class="widget-toolbar no-border">
    </div>
  </div>

  <div class="widget-body">
    <div class="widget-main padding-5">
      <div class="tab-content padding-8">

        <div id="tasks-tab" class="tab-pane active" style="margin-bottom: 50px;">
          <div class="clearfix">

            <% if @project.todos.where('is_complete is null or is_complete = false').count == 0 %>
                None
            <% else %>

                <ul id="tasks" class="item-list">

                  <% @project.todos.each do |todo| %>

                      <li class="<%= get_item_color(todo) %> clearfix task" data-pk='<%= todo.id %>' data-completed="<%= todo.is_complete %>" id="task_<%= todo.id %>">
                        <label class="inline"><span class="lbl"><i class='icon-check-empty bigger-130'></i> <%= todo.subject %></span></label>
                      </li>

                  <% end %>

                </ul>

            <% end %>

          </div>
        </div>


      </div>
    </div>
  </div>
</div>
<!-- end widget -->

</div>

<div class="span6" id='right-column'>


  <!-- widget -->
  <div class="widget-box transparent">

    <div class="widget-header">
      <h4 class="lighter smaller"><i class="icon-heart-empty"></i> PERCENT COMPLETE and STATUS</h4>

      <div class="widget-toolbar no-border">
      </div>
    </div>

    <div class="widget-body">
      <div class="widget-main padding-5">
        <div class="tab-content padding-8">

          <div class="span4 center">
            <div class="easy-pie-chart percentage center" data-percent="<%= @project.percent_complete.to_s %>" data-color='<%= get_project_progress_color(@project) %>'>
              <span class="percent"><%= @project.percent_complete.to_s %></span>%
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
  <!-- end widget -->



  <!-- widget -->
  <div class="widget-box transparent">
    <div class="widget-header">
      <h4 class="lighter smaller"><i class="icon-wrench"></i> OPEN ISSUES</h4>
      <div class="widget-toolbar no-border">
      </div>
    </div>

    <div class="widget-body">
      <div class="widget-main padding-5">
        <div class="tab-content padding-8">

          <% if @project.issues.count == 0 %>
              None
          <% else %>
              <% @project.issues.where('is_resolved is null').each do |issue| %>
                  <div class="alert <%= get_issue_status_color(issue) %>">
                    <a href="/projects/<%= @project.id %>/issues/<%= issue.id %>"><i class="icon-wrench"></i> <%= issue.description %></a>
                    &nbsp;
                    <span class="badge badge-grey"><%= issue.member.user.name unless issue.member.nil? %></span>
                  </div>
              <% end %>
          <% end %>

        </div>
      </div>
    </div>
  </div>
  <!-- end widget -->




  <!-- widget -->
  <div class="widget-box transparent">

    <div class="widget-header">
      <h4 class="lighter smaller"><i class="icon-bell"></i> ALERTS</h4>

      <div class="widget-toolbar no-border">
      </div>
    </div>

    <div class="widget-body">
      <div class="widget-main padding-5">
        <div class="tab-content padding-8">

          <% if @late_todos.count == 0 %>
              None
          <% else %>

              <ul class='unstyled space2'>
                <% @late_todos.each do |o| %>
                    <li><i class="icon-circle red"></i>Todo "<%= o.subject %>" is late!</li>
                <% end %>
              </ul>

          <% end %>

        </div>
      </div>
    </div>
  </div>
  <!-- end widget -->


  <!-- widget -->
  <div class="widget-box transparent">

    <div class="widget-header">
      <h4 class="lighter smaller"><i class="icon-exchange"></i> ACTIVITY</h4>

      <div class="widget-toolbar no-border">
      </div>
    </div>

    <div class="widget-body">
      <div class="widget-main padding-5">
        <div class="tab-content padding-8">
          <div id="progress-gadget" class="tab-pane active">
            <ul class='unstyled space2'>
              <% @project.audits.each do |a| %>
                  <li><i class="icon-circle green"></i><%= User.find(a.user_id).name %> <%= a.action %>d
                    this <%= a.auditable_type.downcase %> <%= time_ago_in_words(a.created_at) %> ago
                  </li>
              <% end %>
              <% @project.associated_audits.each do |a| %>
                  <li><i class="icon-circle green"></i><%= User.find(a.user_id).name %> <%= a.action %>d
                    a <%= a.auditable_type.downcase %> <%= time_ago_in_words(a.created_at) %> ago
                  </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end widget -->

</div>

</div>


</div>
<!--/row-->

<p>
  <%= render :partial => "comments", :locals => {project: @project} %>
</p>

<!--PAGE CONTENT ENDS-->
</div>
<!--/.span-->
</div>
<!--/.row-fluid-->
</div>
<!--/.page-content-->

<div class="ace-settings-container" id="ace-settings-container">
  <div class="btn btn-app btn-mini btn-warning ace-settings-btn" id="ace-settings-btn">
    <i class="icon-cog bigger-150"></i>
  </div>

  <div class="ace-settings-box" id="ace-settings-box">
    <div>
      <div class="pull-left">
        <select id="skin-colorpicker" class="hide">
          <option data-skin="default" value="#438EB9">#438EB9</option>
          <option data-skin="skin-1" value="#222A2D">#222A2D</option>
          <option data-skin="skin-2" value="#C6487E">#C6487E</option>
          <option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
        </select>
      </div>
      <span>&nbsp; Choose Skin</span>
    </div>

    <div>
      <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar"/>
      <label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
    </div>

    <div>
      <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar"/>
      <label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
    </div>

    <div>
      <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs"/>
      <label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
    </div>

    <div>
      <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl"/>
      <label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
    </div>
  </div>
</div>
<!--/#ace-settings-container-->
</div><!--/.main-content-->
</div><!--/.main-container-->

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
  <i class="icon-double-angle-up icon-only bigger-110"></i>
</a>

<!-- inline scripts related to this page -->

<script type="text/javascript" src="/assets/js/jquery.easy-pie-chart.min.js"></script>
<script type="text/javascript">

    $(function () {

        //$('.dialogs,.comments').slimScroll({
        //    height: '300px'
        //});

        //$('.date-picker').datepicker();

        //var oldie = $.browser.msie && $.browser.version < 9;

        var $tooltip = $("<div class='tooltip top in' style='display:none;'><div class='tooltip-inner'></div></div>").appendTo('body');
        $('[data-rel="tooltip"]').tooltip();

        $('.task').each(function () {
            var done = ($(this).attr('data-completed') == "true");
            var pk = $(this).attr('data-pk');
            if (done) {
                $(this).addClass('selected');
                $('#chk_' + pk).attr('checked', true);  //WORKS!
            }
        });

        $('.easy-pie-chart.percentage').each(function () {
            var $box = $(this).closest('.infobox');
            var barColor = $(this).data('color') || (!$box.hasClass('infobox-dark') ? $box.css('color') : 'rgba(255,255,255,0.95)');
            var trackColor = barColor == 'rgba(255,255,255,0.95)' ? 'rgba(255,255,255,0.25)' : '#E2E2E2';
            var size = parseInt($(this).data('size')) || 150;
            $(this).easyPieChart({
                barColor: barColor,
                trackColor: trackColor,
                scaleColor: false,
                lineCap: 'butt',
                lineWidth: 50, //parseInt(size / 10),
                size: size
            });
        });

    });


</script>
